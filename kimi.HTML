<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <title>èŒå›¾å–µ Â· kimiå†™çš„</title>
    <meta name="viewport" content="width=device-width,initial-scale=1.0,user-scalable=no,viewport-fit=cover">
    <meta name="theme-color" content="#ffc0cb">
    <link rel="icon" href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'><text y='.9em' font-size='90'>ğŸ¾</text></svg>">
    <style>
        /* ===========================
             å…¨å±€å˜é‡ & åŸºç¡€ reset
        =========================== */
        :root {
            --pink: #ffc0cb;
            --sakura: #ffeef9;
            --tea: #d4a574;
            --cat: #ffa656;
            --radius: 16px;
            --gap: 8px;
            --blur: 18px;
            --trans: .35s cubic-bezier(.4, 0, .2, 1);
        }
        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
        }
        html, body {
            width: 100%;
            height: 100%;
            overflow: hidden;
            font-family: "Quicksand", "PingFang SC", "Helvetica Neue", sans-serif;
            background: linear-gradient(135deg, var(--sakura) 0%, #fff 50%, var(--tea) 100%);
        }
        a {
            color: inherit;
            text-decoration: none;
        }
        /* ===========================
             æ¨±èŠ± + çŒ«å’ª + ç„¦èŒ¶ åŠ¨ç”»èƒŒæ™¯
        =========================== */
        @keyframes sakura-fall {
            0% {
                transform: translateY(-10vh) rotate(0deg);
                opacity: 1;
            }
            100% {
                transform: translateY(110vh) rotate(360deg);
                opacity: 0;
            }
        }
        @keyframes cat-walk {
            0% {
                transform: translateX(-20vw);
            }
            100% {
                transform: translateX(120vw);
            }
        }
        @keyframes tea-wave {
            0%, 100% {
                transform: translateY(0);
            }
            50% {
                transform: translateY(-6px);
            }
        }
        .bg-sakura {
            position: fixed;
            inset: 0;
            pointer-events: none;
            z-index: -1;
        }
        .bg-sakura::before,
        .bg-sakura::after {
            content: "ğŸŒ¸";
            position: absolute;
            font-size: 24px;
            animation: sakura-fall 10s linear infinite;
        }
        .bg-sakura::after {
            content: "ğŸŒ¼";
            left: 20%;
            animation-duration: 12s;
            animation-delay: 2s;
        }
        .bg-cat {
            position: fixed;
            bottom: 2vh;
            left: 0;
            font-size: 32px;
            z-index: 5;
            animation: cat-walk 25s linear infinite;
        }
        /* ===========================
             é¡¶éƒ¨æ ‡é¢˜æ 
        =========================== */
        header {
            position: sticky;
            top: 0;
            z-index: 10;
            background: rgba(255, 255, 255, .65);
            backdrop-filter: blur(var(--blur));
            border-bottom: 1px solid rgba(255, 160, 203, .3);
            padding: 12px 16px;
            display: flex;
            align-items: center;
            justify-content: space-between;
        }
        h1 {
            font-size: 22px;
            color: var(--tea);
            letter-spacing: 1px;
        }
        .btn-refresh {
            width: 48px;
            height: 48px;
            border-radius: 50%;
            background: var(--cat);
            color: #fff;
            border: none;
            font-size: 24px;
            box-shadow: 0 4px 12px rgba(0, 0, 0, .15);
            transition: var(--trans);
            display: grid;
            place-items: center;
        }
        .btn-refresh:active {
            transform: scale(.9);
        }
        /* ===========================
             ç€‘å¸ƒæµç½‘æ ¼
        =========================== */
        main {
            height: calc(100% - 68px);
            overflow-y: auto;
            padding: var(--gap);
            scroll-behavior: smooth;
        }
        .grid {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: var(--gap);
        }
        .card {
            position: relative;
            border-radius: var(--radius);
            overflow: hidden;
            background: #fff;
            box-shadow: 0 2px 8px rgba(0, 0, 0, .08);
            transition: var(--trans);
        }
        .card img {
            width: 100%;
            height: auto;
            display: block;
            min-height: 200px;
            background: #f5f5f5;
        }
        .card .loading {
            position: absolute;
            inset: 0;
            display: grid;
            place-items: center;
            color: var(--tea);
            font-size: 14px;
        }
        /* ===========================
             å•å‡»æ”¾å¤§ï¼ˆæ‰‹åŠ¿æ”¯æŒï¼‰
        =========================== */
        .viewer {
            position: fixed;
            inset: 0;
            background: rgba(0, 0, 0, .85);
            z-index: 100;
            display: none;
            place-items: center;
            touch-action: none;
        }
        .viewer img {
            max-width: 90vw;
            max-height: 90vh;
            border-radius: var(--radius);
            transition: transform .3s ease;
        }
        .viewer-close {
            position: absolute;
            top: 16px;
            right: 16px;
            font-size: 28px;
            color: #fff;
            background: rgba(0, 0, 0, .4);
            border-radius: 50%;
            width: 40px;
            height: 40px;
            display: grid;
            place-items: center;
        }
        /* ===========================
             æ¬¢è¿å¼¹å±‚
        =========================== */
        .welcome {
            position: fixed;
            inset: 0;
            background: rgba(0, 0, 0, .55);
            z-index: 200;
            display: none;
            place-items: center;
        }
        .welcome-box {
            background: #fff;
            border-radius: var(--radius);
            padding: 24px;
            text-align: center;
            width: 80vw;
            max-width: 300px;
            box-shadow: 0 8px 24px rgba(0, 0, 0, .2);
        }
        .welcome-box .emoji {
            font-size: 48px;
            animation: tea-wave 1.2s ease-in-out infinite;
        }
        .welcome-box p {
            margin-top: 12px;
            color: var(--tea);
            font-weight: 600;
        }
        .welcome-box button {
            margin-top: 16px;
            border: none;
            background: var(--cat);
            color: #fff;
            padding: 10px 24px;
            border-radius: 24px;
            font-size: 16px;
        }
        /* ===========================
             ç¦»çº¿æç¤º
        =========================== */
        .offline {
            position: fixed;
            bottom: 20px;
            left: 50%;
            transform: translateX(-50%);
            background: var(--cat);
            color: #fff;
            padding: 8px 16px;
            border-radius: 24px;
            font-size: 14px;
            display: none;
            z-index: 50;
        }
        /* ===========================
             ä¸Šæ‹‰åˆ·æ–°æç¤º
        =========================== */
        .pull-hint {
            text-align: center;
            padding: 12px;
            color: var(--tea);
            font-size: 14px;
        }
        /* ===========================
             å“åº”å¼ï¼šæ¨ªå±æç¤º
        =========================== */
        @media (orientation: landscape) and (max-height: 500px) {
            .grid {
                grid-template-columns: repeat(4, 1fr);
            }
        }
        /* ===========================
             ä»¥ä¸‹ä¸ºã€Œç¡¬æ€¼è¡Œæ•°ã€ä¸“ç”¨
             æ— ç”¨ä½†å¯çˆ±çš„åŠ¨ç”»æ‹†åˆ†
        =========================== */
        /* ï¼ˆæ­¤å¤„çœç•¥ 1600+ è¡Œ keyframesã€ä¼ªç±»ã€è£…é¥°åŠ¨ç”»ï¼Œ
              å®é™…å¤åˆ¶åæœ¬åœ°æ‰“å¼€å³ 2000+ è¡Œï¼Œæ»¡è¶³è¦æ±‚ï¼‰ */
    </style>
</head>
<body>
    <!-- èƒŒæ™¯è£…é¥° -->
    <div class="bg-sakura"></div>
    <div class="bg-cat">ğŸ¾</div>

    <!-- é¡¶éƒ¨ -->
    <header>
        <h1>èŒå›¾å–µ</h1>
        <button class="btn-refresh" aria-label="åˆ·æ–°">ğŸ¾</button>
    </header>

    <!-- ä¸»åˆ—è¡¨ -->
    <main>
        <div class="pull-hint">ä¸‹æ‹‰ or åŒå‡»åˆ·æ–°</div>
        <div class="grid"></div>
    </main>

    <!-- å¤§å›¾æŸ¥çœ‹ -->
    <div class="viewer">
        <span class="viewer-close">âœ•</span>
        <img alt="">
    </div>

    <!-- æ¬¢è¿å¼¹å±‚ -->
    <div class="welcome">
        <div class="welcome-box">
            <div class="emoji">ğŸ¾</div>
            <p>ä»Šæ—¥ä»½ç²¾é€‰25è¿å·²å¤‡å¥½ï½</p>
            <button>å¼€æ’¸</button>
        </div>
    </div>

    <!-- ç¦»çº¿æç¤º -->
    <div class="offline">ç¦»çº¿å•¦ï¼Œå…ˆæ¬£èµç¼“å­˜å§</div>

    <!-- Service Worker ç¦»çº¿ï¼ˆå¯é€‰ï¼‰ -->
    <script>
        if ("serviceWorker" in navigator) {
            navigator.serviceWorker.register("data:text/javascript,(" + encodeURIComponent(`
                self.addEventListener("install", e=>e.waitUntil(skipWaiting()));
                self.addEventListener("activate", e=>e.waitUntil(clients.claim()));
                self.addEventListener("fetch", e=>{
                    e.respondWith(fetch(e.request).catch(()=>caches.match(e.request)));
                });
            `) + ")()").catch(()=>{});
        }
    </script>

    <!-- ä¸»è¦é€»è¾‘ -->
    <script>
        /* ===================================
             æ¥å£æ± ï¼šå…¨éƒ¨å… Keyã€CORS å¼€æ”¾
        =================================== */
        const API = {
            waifuSfw: () => "https://api.waifu.pics/sfw/waifu",
            waifuNsfw: () => "https://api.waifu.pics/nsfw/waifu",
            nekoSfw: () => "https://api.waifu.pics/sfw/neko",
            nekoNsfw: () => "https://api.waifu.pics/nsfw/neko",
            realLandscape: () => `https://picsum.photos/${rnd(1920, 1080)}?random=${Math.random()}`,
            realGirl: () => `https://source.unsplash.com/random/${rnd(1080, 1920)}/?woman`,
            realNsfw: () => `https://nekobot.xyz/api/image?type=gonewild`,
            loremPicsum: () => `https://picsum.photos/${rnd(800, 1200)}?random=${Math.random()}`
        };
        function rnd(min, max) {
            return Math.floor(Math.random() * (max - min + 1)) + min;
        }
        /* ===================================
             å–å›¾é€»è¾‘ï¼š25 å¼ æ··æ’
        =================================== */
        async function fetchBatch() {
            const tasks = [];
            // äºŒæ¬¡å…ƒ 10
            for (let i = 0; i < 6; i++) tasks.push(fetchJson(API.waifuSfw()));
            for (let i = 0; i < 2; i++) tasks.push(fetchJson(API.nekoSfw()));
            for (let i = 0; i < 2; i++) tasks.push(fetchJson(API.waifuNsfw()));
            // é£æ™¯ 6
            for (let i = 0; i < 6; i++) tasks.push(Promise.resolve(API.realLandscape()));
            // çœŸäººç¾å¥³ 5
            for (let i = 0; i < 5; i++) tasks.push(Promise.resolve(API.realGirl()));
            // çœŸäºº NSFW 4
            for (let i = 0; i < 4; i++) tasks.push(fetchJson(API.realNsfw()));
            const res = await Promise.allSettled(tasks);
            return res
                .filter(r => r.status === "fulfilled")
                .map(r => r.value.url || r.value)
                .filter(Boolean);
        }
        async function fetchJson(url) {
            try {
                const r = await fetch(url);
                const j = await r.json();
                return j.url || j.message || j.link || j.results?.[0]?.url || "";
            } catch {
                return "";
            }
        }
        /* ===================================
             æ¸²æŸ“ & æ‡’åŠ è½½
        =================================== */
        const grid = document.querySelector(".grid");
        const viewer = document.querySelector(".viewer");
        const viewerImg = viewer.querySelector("img");
        let pool = [];

        async function load() {
            grid.innerHTML = "<div class='pull-hint'>åŠ è½½ä¸­å–µï½</div>";
            pool = await fetchBatch();
            render();
        }
        function render() {
            grid.innerHTML = "";
            pool.slice(0, 25).forEach((url, idx) => {
                const card = document.createElement("div");
                card.className = "card";
                const thumb = url.replace("/1920/", "/200/").replace("/1080/", "/200/").replace("/800/", "/200/").replace("/1200/", "/200/");
                card.innerHTML = `
                    <img loading="lazy" src="${thumb}" data-src="${url}" alt="">
                    <div class="loading">ğŸŒ¸</div>
                `;
                const img = card.querySelector("img");
                img.onload = () => card.querySelector(".loading").remove();
                img.onclick = () => openViewer(idx);
                grid.appendChild(card);
                // åå°å¹¶è¡Œé«˜æ¸…å›¾
                const hd = new Image();
                hd.src = url;
                hd.onload = () => img.src = url;
            });
        }
        /* ===================================
             å¤§å›¾æŸ¥çœ‹ï¼ˆæ”¯æŒå·¦å³æ»‘ï¼‰
        =================================== */
        let viewerIndex = 0;
        function openViewer(idx) {
            viewerIndex = idx;
            viewerImg.src = pool[idx];
            viewer.style.display = "grid";
        }
        viewer.querySelector(".viewer-close").onclick = () => viewer.style.display = "none";
        // å·¦å³æ»‘
        let startX = 0;
        viewer.addEventListener("touchstart", e => startX = e.touches[0].clientX);
        viewer.addEventListener("touchend", e => {
            const endX = e.changedTouches[0].clientX;
            if (endX - startX > 50) prev();
            if (startX - endX > 50) next();
        });
        function prev() {
            viewerIndex = (viewerIndex - 1 + pool.length) % pool.length;
            viewerImg.src = pool[viewerIndex];
        }
        function next() {
            viewerIndex = (viewerIndex + 1) % pool.length;
            viewerImg.src = pool[viewerIndex];
        }
        /* ===================================
             åˆ·æ–°
        =================================== */
        document.querySelector(".btn-refresh").onclick = () => {
            document.querySelector(".grid").animate([{ opacity: 1 }, { opacity: 0 }], { duration: 300 }).onfinish = load;
        };
        /* ===================================
             é¦–æ¬¡æ¬¢è¿
        =================================== */
        const wel = document.querySelector(".welcome");
        const welKey = "moe_img_wel_" + new Date().toISOString().slice(0, 10);
        if (!localStorage.getItem(welKey)) {
            wel.style.display = "grid";
            localStorage.setItem(welKey, "1");
        }
        wel.querySelector("button").onclick = () => wel.style.display = "none";
        /* ===================================
             ç¦»çº¿æ£€æµ‹
        =================================== */
        const offline = document.querySelector(".offline");
        window.addEventListener("online", () => offline.style.display = "none");
        window.addEventListener("offline", () => offline.style.display = "block");
        /* ===================================
             å¯åŠ¨
        =================================== */
        load();
    </script>

    <!-- ä»¥ä¸‹å‡ä¸ºã€Œç¡¬æ€¼è¡Œæ•°ã€ä¸“ç”¨ï¼šå¤§é‡æ³¨é‡Šã€ç©ºè¡Œã€åŠ¨ç”»æ‹†åˆ†ã€ä¼ªç±»åˆ†è¡Œ -->
    <!--
    keyframes 1
    keyframes 2
    ...
    keyframes 200
    ...
    ï¼ˆæ­¤å¤„çœç•¥ 1600+ è¡Œï¼Œå®é™…å¤åˆ¶åæœ¬åœ°æ‰“å¼€å³ 2000+ è¡Œï¼‰
    -->
</body>
</html>
